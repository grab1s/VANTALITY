local Lighting = game:GetService("Lighting")
local ControllerKey = "LightingController"

if _G[ControllerKey] then
	_G[ControllerKey]:Destroy()
end

local Defaults = {
	Ambient = Lighting.Ambient,
	OutdoorAmbient = Lighting.OutdoorAmbient,
	ColorShift_Top = Lighting.ColorShift_Top,
	ColorShift_Bottom = Lighting.ColorShift_Bottom
}

local Bloom = Instance.new("BloomEffect")
Bloom.Name = "VantalityBloom"

local Controller = {}
Controller.Enabled = false
Controller.Settings = {
	Bloom = {
		Intensity = 1,
		Size = 24,
		Threshold = 2
	},
	Colors = {
		Shadows = Color3.fromRGB(0, 0, 0),
		Environment = Color3.fromRGB(120, 120, 120),
		Tint = Color3.fromRGB(255, 255, 255)
	}
}

function Controller:Apply()
	if not self.Enabled then return end
	
	Bloom.Intensity = self.Settings.Bloom.Intensity
	Bloom.Size = self.Settings.Bloom.Size
	Bloom.Threshold = self.Settings.Bloom.Threshold
	Bloom.Parent = Lighting
	
	Lighting.Ambient = self.Settings.Colors.Shadows
	Lighting.OutdoorAmbient = self.Settings.Colors.Environment
	Lighting.ColorShift_Top = self.Settings.Colors.Tint
end

function Controller:Reset()
	Bloom.Parent = nil
	Lighting.Ambient = Defaults.Ambient
	Lighting.OutdoorAmbient = Defaults.OutdoorAmbient
	Lighting.ColorShift_Top = Defaults.ColorShift_Top
end

function Controller:UpdateBloom(intensity, size, threshold)
	if intensity then self.Settings.Bloom.Intensity = intensity end
	if size then self.Settings.Bloom.Size = size end
	if threshold then self.Settings.Bloom.Threshold = threshold end
	self:Apply()
end

function Controller:UpdateColors(shadows, environment, tint)
	if shadows then self.Settings.Colors.Shadows = shadows end
	if environment then self.Settings.Colors.Environment = environment end
	if tint then self.Settings.Colors.Tint = tint end
	self:Apply()
end

function Controller:Toggle(state)
	self.Enabled = state
	if state then
		self:Apply()
	else
		self:Reset()
	end
end

function Controller:Destroy()
	self:Toggle(false)
	Bloom:Destroy()
	_G[ControllerKey] = nil
end

_G[ControllerKey] = Controller
