_G.SpooferSettings = {
    DisplayName = {
        Enabled = false,
        Value = "grabis",
        Real = game:GetService("Players").LocalPlayer.DisplayName -- Запоминаем оригинал
    },
    UserName = {
        Enabled = false,
        Value = "grabis_user",
        Real = game:GetService("Players").LocalPlayer.Name -- Запоминаем оригинал
    }
}

local Players = game:GetService("Players")
local CoreGui = gethui and gethui() or game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

local Connections = {} 

local function ApplySpoof(text)
    local newText = text
    
    if _G.SpooferSettings.DisplayName.Enabled then
        local real = _G.SpooferSettings.DisplayName.Real
        local fake = _G.SpooferSettings.DisplayName.Value
        if text:find(real) then
            newText = newText:gsub(real, fake)
        end
    end

    if _G.SpooferSettings.UserName.Enabled then
        local real = _G.SpooferSettings.UserName.Real
        local fake = _G.SpooferSettings.UserName.Value
        if text:find(real) then
            newText = newText:gsub(real, fake)
        end
    end

    return newText
end

local function MonitorObject(obj)
    if not obj or not obj.Parent then return end
    if Connections[obj] then return end -- Уже следим за этим объектом
    
    if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
        
        local currentText = obj.Text
        local spoofedText = ApplySpoof(currentText)
        
        if currentText ~= spoofedText then
            pcall(function() 
                obj.Text = spoofedText 
            end)
        end

        local conn = obj:GetPropertyChangedSignal("Text"):Connect(function()
            local txt = obj.Text
            
            if ( _G.SpooferSettings.DisplayName.Enabled and txt:find(_G.SpooferSettings.DisplayName.Real) ) 
            or ( _G.SpooferSettings.UserName.Enabled and txt:find(_G.SpooferSettings.UserName.Real) ) then
                
                local new = ApplySpoof(txt)
                if new ~= txt then
                    pcall(function() obj.Text = new end)
                end
            end
        end)
        
        Connections[obj] = conn
        
        obj.AncestryChanged:Connect(function()
            if not obj.Parent then
                if Connections[obj] then
                    Connections[obj]:Disconnect()
                    Connections[obj] = nil
                end
            end
        end)
    end
end

local function ScanAndHook(parent)
    -- Сканируем уже существующее
    for _, v in pairs(parent:GetDescendants()) do
        MonitorObject(v)
    end
    
    parent.DescendantAdded:Connect(function(v)
        if v:IsA("TextLabel") or v:IsA("TextButton") then
           task.wait() 
           MonitorObject(v)
        end
    end)
end

task.spawn(function()
    ScanAndHook(CoreGui) -- Интерфейс Роблокса
    ScanAndHook(LocalPlayer:WaitForChild("PlayerGui")) -- Интерфейс Игры
end)


_G.ForceUpdateNames = function()
    _G.SpooferSettings.DisplayName.Real = LocalPlayer.DisplayName
    _G.SpooferSettings.UserName.Real = LocalPlayer.Name

    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        if _G.SpooferSettings.DisplayName.Enabled then
             LocalPlayer.Character.Humanoid.DisplayName = _G.SpooferSettings.DisplayName.Value
        else
             LocalPlayer.Character.Humanoid.DisplayName = _G.SpooferSettings.DisplayName.Real
        end
    end
    
    for obj, conn in pairs(Connections) do
        if obj and obj.Parent then
            local txt = obj.Text
            if not _G.SpooferSettings.DisplayName.Enabled and not _G.SpooferSettings.UserName.Enabled then
                local restored = txt
                restored = restored:gsub(_G.SpooferSettings.DisplayName.Value, _G.SpooferSettings.DisplayName.Real)
                restored = restored:gsub(_G.SpooferSettings.UserName.Value, _G.SpooferSettings.UserName.Real)
                pcall(function() obj.Text = restored end)
            else
                local spoofed = ApplySpoof(txt)
                if spoofed ~= txt then
                    pcall(function() obj.Text = spoofed end)
                end
            end
        else
            Connections[obj] = nil
        end
    end
end
