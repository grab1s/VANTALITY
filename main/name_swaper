_G.SpooferSettings = {
    DisplayName = { Enabled = false, Value = "grabis", Real = "" },
    UserName    = { Enabled = false, Value = "grabis_user", Real = "" }
}

local Players = game:GetService("Players")
local CoreGui = gethui and gethui() or game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

local RealName = LocalPlayer.Name
local RealDisplayName = LocalPlayer.DisplayName
_G.SpooferSettings.DisplayName.Real = RealDisplayName
_G.SpooferSettings.UserName.Real = RealName

local Connections = {}

local function escape(text)
    return text:gsub("([^%w])", "%%%1")
end

local function UpdateObject(obj)
    if not obj or not obj.Parent then return end
    
    pcall(function()
        local currentText = obj.Text
        local newText = currentText
        
        local s = _G.SpooferSettings
        
        if s.DisplayName.Value ~= "" and newText:find(s.DisplayName.Value, 1, true) then
            newText = newText:gsub(escape(s.DisplayName.Value), s.DisplayName.Real)
        end
        if s.UserName.Value ~= "" and newText:find(s.UserName.Value, 1, true) then
            newText = newText:gsub(escape(s.UserName.Value), s.UserName.Real)
        end
        
        if s.DisplayName.Enabled then
             newText = newText:gsub(escape(RealDisplayName), s.DisplayName.Value)
        end
        if s.UserName.Enabled then
             newText = newText:gsub(escape(RealName), s.UserName.Value)
        end
        
        if newText ~= currentText then
            obj.Text = newText
        end
    end)
end

local function HookObject(obj)
    if not obj or not obj.Parent then return end
    if Connections[obj] then return end -- Уже следим

    if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
        Connections[obj] = true
        
        UpdateObject(obj)
        
        obj:GetPropertyChangedSignal("Text"):Connect(function()
            UpdateObject(obj)
        end)
        
        obj.AncestryChanged:Connect(function()
            if not obj.Parent then Connections[obj] = nil end
        end)
    end
end

local function Scan(parent)
    for _, v in pairs(parent:GetDescendants()) do
        HookObject(v)
    end
    parent.DescendantAdded:Connect(function(v)
        if v:IsA("TextLabel") or v:IsA("TextButton") then
            task.wait() -- Даем такт на прогрузку текста
            HookObject(v)
        end
    end)
end

_G.ForceUpdateNames = function()
    _G.SpooferSettings.DisplayName.Real = LocalPlayer.DisplayName
    _G.SpooferSettings.UserName.Real = LocalPlayer.Name
    
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        local hum = LocalPlayer.Character.Humanoid
        if _G.SpooferSettings.DisplayName.Enabled then
            hum.DisplayName = _G.SpooferSettings.DisplayName.Value
        else
            hum.DisplayName = RealDisplayName
        end
    end
    
    for obj, _ in pairs(Connections) do
        UpdateObject(obj)
    end
end

task.spawn(function()
    Scan(CoreGui)
    Scan(LocalPlayer:WaitForChild("PlayerGui"))
end)

print("Simple Spoofer V5 Loaded")
